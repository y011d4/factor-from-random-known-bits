from collections import Counter
from Crypto.Util.number import *
import sys
import random
import sympy

flag = open("flag.txt", "rb").read()
print("Loading... this may take a while.")
# p, q = getPrime(4096), getPrime(4096)
p = 1026425489811410154939564330855126910294054624327594068393599330304159964093796641513751922314812554020064574891490673912596072620168714995403643835061896188790756223382222617571855106445326142739551265677862164207875957516478182236814947302551022524484925137164027825054079357474914319847907281582251076726102493643151425255226777384202284599156369363373563642604745988351539992375932670122375621885209873017785436016020435017978053427514364179198035581419291064193143912481690001354300057585042828156962675239775071887979684757536819513306850763668517928489517504927452552162939872700807640351677493869972758820579169090676582753434717869612768936969479106103677792036592591525253773791964700899607724830220666704363012347297530024777101853264936262593009663488486590961760704732696757346560710898582595069246914920687953157305824804491250148764002866105497661178187082037356062332307348555641200201094332852115589136147061683254988284911411038232213180436604722460221221683317461752299144307920409776427279433732673595593846759912534482804113536355504073009187275379612098049501463654478795374584247337053340452322946778347546797205954284458371217689790568891843847863509978597873910159042514411161754488700822562383501114340695307
q = 1043395680645709616430238458303195628267595941826074884197610956272518685169237892257685338085515270472552822744247261654423963842191142037642837920964800633693576392267555249330411657032553703156253205694716092034139527191916079517847830974370662628631791588855728122525062546019057198352330260052007852705437549448884983289498940758993888339215908248039577148907368366410455106129378046322061894612017658889241375715407634414995796890538237944336144443711878126149718493789401770495535773111695769971508315510017254311001534617670751777218597367572636211463332971996559344483815910952592503307235782641373579572043768640608292900021752003390020186654466042409056433113656899144822544860046502540981609954568853744595384279026309061485766510484430418314523778355368947845899338306665838799449847600194704170302644891201942590145707084408673363236338735320909623421936216080709297429099298246664201573778101685813476833025304391362768460926143100965693130874923384062590760046469772424813296120707214816425685695593470565364151176866332389941154164234137981648148342496747222830095027767141778639485792584690124754600956527467686001491244941041338137797069982744687435642509704783437673181296992620594796363880090948363387722267765401
e = 0x10001
n = p * q
m = random.randrange(0, n)
c = pow(m, e, n)
d = sympy.mod_inverse(e, (p - 1) * (q - 1))


def menu(guesses):
    print()
    print("1. Source")
    print("2. Public key")
    print("3. Decrypt")
    print("4. Play")
    print("\nYou have " + str(guesses) + " guesses left.")
    choice = input(": ").strip()
    if choice == "1":
        f = open(__file__)
        print()
        print(f.read())
        print()
        menu(guesses)
    elif choice == "2":
        print("\nn = " + str(n))
        print("e = 65537")
        menu(guesses)
    elif choice == "3":
        d_ = int(input("What is the private key?\n: "))
        if pow(c, d_, n) == m:
            print("Congrats! Here is your flag:")
            print(flag)
            sys.exit()
        else:
            print("\nSorry, that is incorrect.")
            menu(guesses)
    elif choice == "4":
        if guesses == 0:
            print("Sorry, you have no more guesses.")
            menu(0)
        else:
            if guesses > 8:
                code = list(hex(p)[2:])
            else:
                code = list(hex(q)[2:])
            guess = input("Make a guess.\n: ")
            while len(guess) != 1024:
                guess = input("Try again.\n: ")
            guess = list(guess)
            a = "".join(["1" if guess[i] == code[i] else "0" for i in range(1024)])
            print(a)
            guesses -= 1
            menu(guesses)
    else:
        print("That is not a valid choice.")
        menu(guesses)


while 1:
    menu(16)
